<div class="modal-overlay" (click)="onClose()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Edit Reservation</h2>
      <button class="close-btn" (click)="onClose()" type="button" aria-label="Close">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <div class="modal-body">
      @if (error) {
      <div class="error-message">
        <span class="material-symbols-outlined">error</span>
        <p>{{ error }}</p>
      </div>
      }

      <div class="reservation-info">
        <div class="info-row">
          <span class="info-label">Reservation ID:</span>
          <span class="info-value">{{ reservation.reservationId }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Guest:</span>
          <span class="info-value">{{ reservation.guestName || '—' }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Hotel:</span>
          <span class="info-value">{{ reservation.hotelName || '—' }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Room:</span>
          <span class="info-value">{{ reservation.roomId || '—' }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Total Amount:</span>
          <span class="info-value">{{ formatCurrency(reservation.totalAmount) }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Created:</span>
          <span class="info-value">{{ formatDate(reservation.createdAt) }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Last Updated:</span>
          <span class="info-value">{{ formatDate(reservation.updatedAt) }}</span>
        </div>
      </div>

      <form class="edit-form" (ngSubmit)="onSave()">
        <div class="form-grid">

          <div class="form-group">
            <label for="startDate">Check-in Date</label>
            <input
              type="date"
              id="startDate"
              [(ngModel)]="editForm.startDate"
              name="startDate"
              required
            />
          </div>

          <div class="form-group">
            <label for="endDate">Check-out Date</label>
            <input
              type="date"
              id="endDate"
              [(ngModel)]="editForm.endDate"
              name="endDate"
              required
            />
          </div>

          <div class="form-group">
            <label for="guestCount">Guest Count</label>
            <input
              type="number"
              id="guestCount"
              [(ngModel)]="editForm.guestCount"
              name="guestCount"
              min="1"
              required
            />
          </div>

          <div class="form-group">
            <label for="status">Status</label>
            <select id="status" [(ngModel)]="editForm.status" name="status" required>
              @for (status of statusOptions; track status) {
              <option [value]="status">{{ status }}</option>
              }
            </select>
          </div>


          <div class="form-group full-width">
            <label for="specialRequests">Special Requests</label>
            <textarea
              id="specialRequests"
              [(ngModel)]="editForm.specialRequests"
              name="specialRequests"
              rows="3"
              maxlength="2000"
            ></textarea>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="onClose()" [disabled]="loading">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="loading">
            @if (loading) {
            <span class="spinner"></span>
            Saving... } @else { Save Changes }
          </button>
        </div>
      </form>

      <div class="cancel-section">
        <div class="cancel-header">
          <h3>Cancel Reservation</h3>
          @if (!showCancelConfirm) {
          <button type="button" class="btn btn-danger" (click)="showCancelConfirm = true">
            Cancel Reservation
          </button>
          }
        </div>

        @if (showCancelConfirm) {
        <div class="cancel-confirm">
          <p>Are you sure you want to cancel this reservation? This action cannot be undone.</p>
          <div class="form-group">
            <label for="cancelReason">Cancellation Reason (Optional)</label>
            <textarea
              id="cancelReason"
              [(ngModel)]="cancelReason"
              rows="2"
              placeholder="Enter reason for cancellation..."
            ></textarea>
          </div>
          <div class="cancel-actions">
            <button type="button" class="btn btn-secondary" (click)="showCancelConfirm = false">
              Keep Reservation
            </button>
            <button
              type="button"
              class="btn btn-danger"
              (click)="onCancelReservation()"
              [disabled]="loading"
            >
              @if (loading) {
              <span class="spinner"></span>
              Cancelling... } @else { Confirm Cancellation }
            </button>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</div>
